<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>آزمون‌ساز حرفه‌ای</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@tailwindcss/forms@0.5.3/dist/forms.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        }
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;200;300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Vazirmatn', sans-serif;
        }
        
        body {
            transition: background-color 0.3s, color 0.3s;
        }
        
        .dark {
            color-scheme: dark;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 min-h-screen">
    <div id="app" class="container mx-auto px-4 py-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 dark:text-white mb-2">آزمون‌ساز حرفه‌ای</h1>
            <p class="text-gray-600 dark:text-gray-300">ساخت، اشتراک‌گذاری و مدیریت آزمون‌ها به سادگی</p>
        </header>

        <!-- Views Container -->
        <div id="views">
            <!-- Home View -->
            <div id="home-view" class="fade-in">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">به آزمون‌ساز خوش آمدید</h2>
                    <p class="text-gray-600 dark:text-gray-300 mb-6">با استفاده از این ابزار می‌توانید به راحتی آزمون‌های خود را بسازید، به اشتراک بگذارید و نتایج را مشاهده کنید.</p>
                    <div class="flex flex-col md:flex-row gap-4">
                        <button id="create-quiz-btn" class="bg-primary-600 hover:bg-primary-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 flex-1">
                            ساخت آزمون جدید
                        </button>
                        <button id="take-quiz-btn" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-800 dark:text-white font-bold py-3 px-6 rounded-lg transition duration-300 flex-1">
                            شرکت در آزمون
                        </button>
                        <button id="my-quizzes-btn" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-800 dark:text-white font-bold py-3 px-6 rounded-lg transition duration-300 flex-1">
                            آزمون‌های من
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <div class="text-primary-600 dark:text-primary-400 text-4xl mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-center text-gray-800 dark:text-white mb-2">ساخت آزمون</h3>
                        <p class="text-gray-600 dark:text-gray-300 text-center">سوالات چندگزینه‌ای بسازید و آزمون خود را به راحتی طراحی کنید.</p>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <div class="text-primary-600 dark:text-primary-400 text-4xl mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-center text-gray-800 dark:text-white mb-2">به اشتراک‌گذاری</h3>
                        <p class="text-gray-600 dark:text-gray-300 text-center">لینک آزمون را با دیگران به اشتراک بگذارید تا در آن شرکت کنند.</p>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <div class="text-primary-600 dark:text-primary-400 text-4xl mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-center text-gray-800 dark:text-white mb-2">مشاهده نتایج</h3>
                        <p class="text-gray-600 dark:text-gray-300 text-center">نتایج و آمار شرکت‌کنندگان را به صورت دقیق بررسی کنید.</p>
                    </div>
                </div>
            </div>

            <!-- Create Quiz View -->
            <div id="create-quiz-view" class="hidden fade-in">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">ساخت آزمون جدید</h2>
                        <button id="back-to-home-btn" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <form id="quiz-form" class="space-y-6">
                        <div>
                            <label for="quiz-title" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">عنوان آزمون</label>
                            <input type="text" id="quiz-title" name="quiz-title" placeholder="مثال: آزمون ریاضی پایه هفتم" required
                                class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        </div>
                        
                        <div>
                            <label for="quiz-description" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">توضیحات آزمون</label>
                            <textarea id="quiz-description" name="quiz-description" rows="3" placeholder="توضیحات مربوط به آزمون را وارد کنید..."
                                class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></textarea>
                        </div>
                        
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                            <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">سوالات آزمون</h3>
                            <div id="questions-container" class="space-y-6">
                                <!-- Questions will be added here dynamically -->
                            </div>
                            
                            <button type="button" id="add-question-btn" class="mt-4 inline-flex items-center text-primary-600 dark:text-primary-400 font-medium">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                </svg>
                                افزودن سوال جدید
                            </button>
                        </div>
                        
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                            <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">تنظیمات آزمون</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="quiz-time" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">مدت زمان آزمون (دقیقه)</label>
                                    <input type="number" id="quiz-time" name="quiz-time" min="1" value="30"
                                        class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                </div>
                                <div>
                                    <label for="quiz-passing-score" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">نمره قبولی (درصد)</label>
                                    <input type="number" id="quiz-passing-score" name="quiz-passing-score" min="0" max="100" value="60"
                                        class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-end pt-6">
                            <button type="submit" id="save-quiz-btn" class="bg-primary-600 hover:bg-primary-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                                ذخیره و ساخت آزمون
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Take Quiz View -->
            <div id="take-quiz-view" class="hidden fade-in">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">شرکت در آزمون</h2>
                        <button id="back-from-take-quiz" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div id="quiz-entry-form">
                        <p class="text-gray-600 dark:text-gray-300 mb-6">برای شرکت در آزمون، کد آزمون را وارد کنید یا لینک آزمون را بازکنید.</p>
                        
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="flex-1">
                                <label for="quiz-code" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">کد آزمون</label>
                                <input type="text" id="quiz-code" name="quiz-code" placeholder="کد آزمون را وارد کنید..." 
                                    class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                            <div class="flex items-end">
                                <button id="find-quiz-btn" class="bg-primary-600 hover:bg-primary-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300 h-[42px]">
                                    جستجو
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <label for="participant-name" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">نام و نام خانوادگی</label>
                            <input type="text" id="participant-name" name="participant-name" placeholder="نام و نام خانوادگی خود را وارد کنید..." 
                                class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        </div>
                        
                        <div class="flex justify-end mt-6">
                            <button id="start-quiz-btn" class="bg-primary-600 hover:bg-primary-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300" disabled>
                                شروع آزمون
                            </button>
                        </div>
                    </div>
                    
                    <div id="quiz-details" class="hidden">
                        <div class="border-b border-gray-200 dark:border-gray-700 pb-4 mb-6">
                            <h3 id="quiz-info-title" class="text-xl font-bold text-gray-800 dark:text-white mb-2"></h3>
                            <p id="quiz-info-description" class="text-gray-600 dark:text-gray-300"></p>
                            <div class="flex flex-wrap gap-x-6 gap-y-2 mt-4 text-sm text-gray-600 dark:text-gray-400">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                    </svg>
                                    <span id="quiz-info-questions">تعداد سوالات: <span class="font-medium"></span></span>
                                </div>
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <span id="quiz-info-time">زمان: <span class="font-medium"></span> دقیقه</span>
                                </div>
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <span id="quiz-info-passing">نمره قبولی: <span class="font-medium"></span>%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz Taking View -->
            <div id="quiz-taking-view" class="hidden fade-in">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 id="quiz-title-header" class="text-2xl font-bold text-gray-800 dark:text-white"></h2>
                        <div class="flex items-center bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 px-4 py-2 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span id="quiz-timer" class="font-bold"></span>
                        </div>
                    </div>
                    
                    <div class="border-b border-gray-200 dark:border-gray-700 mb-6 pb-6">
                        <div class="flex justify-between items-center">
                            <div id="quiz-progress" class="text-gray-600 dark:text-gray-300 mb-2">سوال <span id="current-question">1</span> از <span id="total-questions"></span></div>
                            <div id="quiz-score" class="text-gray-600 dark:text-gray-300">امتیاز: <span class="font-bold">0</span></div>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                            <div id="progress-bar" class="bg-primary-600 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div id="question-container" class="mb-8">
                        <h3 id="question-text" class="text-xl font-bold text-gray-800 dark:text-white mb-4"></h3>
                        <div id="options-container" class="space-y-3">
                            <!-- Options will be added here dynamically -->
                        </div>
                    </div>
                    
                    <div class="flex justify-between">
                        <button id="prev-question-btn" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-800 dark:text-white font-bold py-2 px-6 rounded-lg transition duration-300" disabled>
                            سوال قبلی
                        </button>
                        <button id="next-question-btn" class="bg-primary-600 hover:bg-primary-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300">
                            سوال بعدی
                        </button>
                    </div>
                </div>
            </div>

            <!-- Results View -->
            <div id="results-view" class="hidden fade-in">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">نتیجه آزمون</h2>
                        <button id="back-to-home-from-results" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div id="results-summary" class="text-center p-6 border-b border-gray-200 dark:border-gray-700 mb-6">
                        <div id="pass-badge" class="hidden mx-auto mb-4 w-24 h-24 flex items-center justify-center rounded-full bg-green-100 dark:bg-green-900">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-green-600 dark:text-green-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div id="fail-badge" class="hidden mx-auto mb-4 w-24 h-24 flex items-center justify-center rounded-full bg-red-100 dark:bg-red-900">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-red-600 dark:text-red-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </div>
                        <h3 id="result-status" class="text-2xl font-bold text-gray-800 dark:text-white mb-2"></h3>
                        <p class="text-gray-600 dark:text-gray-300 mb-4">نمره شما: <span id="final-score" class="font-bold"></span> از <span id="total-score" class="font-bold"></span> (<span id="score-percentage" class="font-bold"></span>%)</p>
                        <p class="text-gray-600 dark:text-gray-300">زمان صرف شده: <span id="time-spent" class="font-bold"></span></p>
                    </div>
                    
                    <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">جزئیات سوالات</h3>
                    <div id="question-details" class="space-y-6">
                        <!-- Question details will be added here dynamically -->
                    </div>
                    
                    <div class="mt-8 flex justify-center">
                        <button id="share-results-btn" class="bg-primary-600 hover:bg-primary-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                            اشتراک‌گذاری نتیجه
                        </button>
                    </div>
                </div>
            </div>

            <!-- My Quizzes View -->
            <div id="my-quizzes-view" class="hidden fade-in">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">آزمون‌های من</h2>
                        <button id="back-from-my-quizzes" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div id="quizzes-list" class="space-y-4">
                        <!-- Quizzes will be listed here -->
                        <div id="no-quizzes" class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <p>هنوز هیچ آزمونی نساخته‌اید</p>
                            <button id="create-first-quiz-btn" class="mt-4 text-primary-600 dark:text-primary-400 font-medium">
                                ساخت اولین آزمون
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz Details View -->
            <div id="quiz-details-view" class="hidden fade-in">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 id="quiz-details-title" class="text-2xl font-bold text-gray-800 dark:text-white"></h2>
                        <button id="back-from-quiz-details" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div class="border-b border-gray-200 dark:border-gray-700 pb-4 mb-6">
                        <p id="quiz-details-description" class="text-gray-600 dark:text-gray-300 mb-4"></p>
                        <div class="flex flex-wrap gap-x-6 gap-y-2 text-sm text-gray-600 dark:text-gray-400">
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                <span>تاریخ ایجاد: <span id="quiz-details-date" class="font-medium"></span></span>
                            </div>
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <span>تعداد سوالات: <span id="quiz-details-questions-count" class="font-medium"></span></span>
                            </div>
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <span>زمان: <span id="quiz-details-time" class="font-medium"></span> دقیقه</span>
                            </div>
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <span>نمره قبولی: <span id="quiz-details-passing" class="font-medium"></span>%</span>
                            </div>
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                <span>تعداد شرکت‌کنندگان: <span id="quiz-details-participants" class="font-medium">0</span></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-700 rounded-lg shadow p-4 text-center">
                            <div class="text-xl font-bold text-gray-800 dark:text-white">کد آزمون</div>
                            <div id="quiz-details-code" class="mt-2 bg-gray-100 dark:bg-gray-600 p-2 rounded font-mono text-primary-600 dark:text-primary-300"></div>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-lg shadow p-4 text-center col-span-2">
                            <div class="text-xl font-bold text-gray-800 dark:text-white">لینک آزمون</div>
                            <div class="mt-2 relative">
                                <input id="quiz-details-link" type="text" readonly
                                    class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-600 text-gray-900 dark:text-white font-mono pr-28">
                                <button id="copy-link-btn" class="absolute left-1 top-1 bg-primary-600 hover:bg-primary-700 text-white font-bold py-1 px-4 rounded text-sm">
                                    کپی لینک
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">نتایج شرکت‌کنندگان</h3>
                        <div id="participants-results" class="overflow-x-auto">
                            <div id="no-participants" class="text-center py-8 text-gray-500 dark:text-gray-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                <p>هنوز هیچ‌کس در این آزمون شرکت نکرده است</p>
                            </div>
                            <table id="results-table" class="hidden w-full table-auto">
                                <thead class="bg-gray-100 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-4 py-2 text-right text-gray-800 dark:text-white">#</th>
                                        <th class="px-4 py-2 text-right text-gray-800 dark:text-white">نام</th>
                                        <th class="px-4 py-2 text-right text-gray-800 dark:text-white">درصد</th>
                                        <th class="px-4 py-2 text-right text-gray-800 dark:text-white">نمره</th>
                                        <th class="px-4 py-2 text-right text-gray-800 dark:text-white">وضعیت</th>
                                        <th class="px-4 py-2 text-right text-gray-800 dark:text-white">تاریخ</th>
                                    </tr>
                                </thead>
                                <tbody id="results-table-body">
                                    <!-- Results will be added here dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Share View -->
            <div id="share-view" class="hidden fade-in">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">اشتراک‌گذاری آزمون</h2>
                        <button id="back-from-share" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div class="text-center p-6 mb-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 text-primary-600 dark:text-primary-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                        </svg>
                        <h3 id="share-quiz-title" class="text-xl font-bold text-gray-800 dark:text-white mb-2"></h3>
                        <p class="text-gray-600 dark:text-gray-300 mb-6">آزمون خود را با دوستان و همکلاسی‌های خود به اشتراک بگذارید</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-700 rounded-lg shadow p-4 text-center">
                            <div class="text-xl font-bold text-gray-800 dark:text-white">کد آزمون</div>
                            <div id="share-quiz-code" class="mt-2 bg-gray-100 dark:bg-gray-600 p-2 rounded font-mono text-primary-600 dark:text-primary-300"></div>
                            <button id="copy-code-btn" class="mt-3 bg-primary-600 hover:bg-primary-700 text-white font-bold py-2 px-4 rounded text-sm">
                                کپی کد
                            </button>
                        </div>
                        <div class="bg-white dark:bg-gray-700 rounded-lg shadow p-4 text-center">
                            <div class="text-xl font-bold text-gray-800 dark:text-white">لینک آزمون</div>
                            <div class="mt-2 relative">
                                <input id="share-quiz-link" type="text" readonly
                                    class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-600 text-gray-900 dark:text-white font-mono pr-24">
                                <button id="copy-share-link-btn" class="absolute left-1 top-1 bg-primary-600 hover:bg-primary-700 text-white font-bold py-1 px-4 rounded text-sm">
                                    کپی لینک
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button id="view-quiz-details-btn" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-800 dark:text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                            مشاهده جزئیات آزمون
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Alert Container -->
            <div id="alert-container" class="fixed left-0 right-0 bottom-4 flex justify-center z-50">
                <div id="alert" class="hidden rounded-lg p-4 shadow-lg max-w-md transition-all duration-300 transform translate-y-10 opacity-0"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });
            
            // Global variables
            let currentView = 'home-view';
            let currentQuiz = null;
            let currentQuestion = 0;
            let userAnswers = [];
            let quizStartTime = null;
            let quizEndTime = null;
            let quizTimer = null;
            let quizDuration = 0;
            let timeRemaining = 0;
            
            // Helper function to generate a unique ID
            function generateUniqueId() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }
            
            // Helper function to format date
            function formatDate(date) {
                const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                return new Date(date).toLocaleDateString('fa-IR', options);
            }
            
            // Helper function to format time
            function formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            }
            
            // Show alert message
            function showAlert(message, type = 'success') {
                const alertEl = document.getElementById('alert');
                alertEl.textContent = message;
                
                if (type === 'success') {
                    alertEl.className = 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded-lg p-4 shadow-lg max-w-md';
                } else if (type === 'error') {
                    alertEl.className = 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded-lg p-4 shadow-lg max-w-md';
                } else if (type === 'info') {
                    alertEl.className = 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded-lg p-4 shadow-lg max-w-md';
                }
                
                // Show the alert
                alertEl.classList.remove('hidden', 'opacity-0', 'translate-y-10');
                alertEl.classList.add('opacity-100', 'translate-y-0');
                
                // Hide the alert after 3 seconds
                setTimeout(() => {
                    alertEl.classList.add('opacity-0', 'translate-y-10');
                    setTimeout(() => {
                        alertEl.classList.add('hidden');
                    }, 300);
                }, 3000);
            }
            
            // Switch between views
            function switchView(viewId) {
                document.getElementById(currentView).classList.add('hidden');
                document.getElementById(viewId).classList.remove('hidden');
                currentView = viewId;
                
                // Scroll to top
                window.scrollTo(0, 0);
            }
            
            // Add a new question to the quiz form
            function addQuestion(questionData = null) {
                const questionsContainer = document.getElementById('questions-container');
                const questionIndex = questionsContainer.children.length;
                
                const questionDiv = document.createElement('div');
                questionDiv.className = 'p-4 border border-gray-200 dark:border-gray-700 rounded-lg question-item';
                questionDiv.dataset.index = questionIndex;
                
                const questionText = questionData ? questionData.text : '';
                const options = questionData ? questionData.options : ['', '', '', ''];
                const correctAnswer = questionData ? questionData.correctAnswer : 0;
                
                questionDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <label class="block text-gray-700 dark:text-gray-300 font-medium">سوال ${questionIndex + 1}</label>
                        <button type="button" class="text-red-500 hover:text-red-700 remove-question-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                    <div class="mb-4">
                        <input type="text" placeholder="متن سوال را وارد کنید..." value="${questionText}" required
                            class="question-text w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    </div>
                    <div class="mb-1">
                        <label class="block text-gray-700 dark:text-gray-300 font-medium mb-2">گزینه‌ها</label>
                        <div class="space-y-3 options-container">
                            ${options.map((option, idx) => `
                                <div class="flex items-center">
                                    <input type="radio" name="correct-option-${questionIndex}" value="${idx}" ${idx === correctAnswer ? 'checked' : ''}
                                        class="w-4 h-4 text-primary-600 border-gray-300 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600">
                                    <input type="text" placeholder="گزینه ${idx + 1}" value="${option}"
                                        class="option-text ml-2 flex-1 px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                questionsContainer.appendChild(questionDiv);
                
                // Add event listener to remove button
                questionDiv.querySelector('.remove-question-btn').addEventListener('click', function() {
                    questionDiv.remove();
                    updateQuestionNumbers();
                });
            }
            
            // Update question numbers after removing a question
            function updateQuestionNumbers() {
                const questions = document.querySelectorAll('.question-item');
                questions.forEach((question, index) => {
                    question.dataset.index = index;
                    question.querySelector('label').textContent = `سوال ${index + 1}`;
                    const radios = question.querySelectorAll('input[type="radio"]');
                    radios.forEach(radio => {
                        radio.name = `correct-option-${index}`;
                    });
                });
            }
            
            // Save quiz to localStorage
            function saveQuiz(quiz) {
                let quizzes = JSON.parse(localStorage.getItem('quizzes') || '[]');
                
                // Find if this quiz already exists
                const existingIndex = quizzes.findIndex(q => q.id === quiz.id);
                if (existingIndex !== -1) {
                    quizzes[existingIndex] = quiz;
                } else {
                    quizzes.push(quiz);
                }
                
                localStorage.setItem('quizzes', JSON.stringify(quizzes));
            }
            
            // Get quiz by ID
            function getQuizById(id) {
                const quizzes = JSON.parse(localStorage.getItem('quizzes') || '[]');
                return quizzes.find(quiz => quiz.id === id);
            }
            
            // Get quiz by code
            function getQuizByCode(code) {
                const quizzes = JSON.parse(localStorage.getItem('quizzes') || '[]');
                return quizzes.find(quiz => quiz.code === code);
            }
            
            // Save quiz result
            function saveQuizResult(quizId, result) {
                let quiz = getQuizById(quizId);
                if (!quiz) return;
                
                if (!quiz.results) {
                    quiz.results = [];
                }
                
                quiz.results.push(result);
                saveQuiz(quiz);
            }
            
            // Start quiz
            function startQuiz(quiz, participantName) {
                currentQuiz = quiz;
                currentQuestion = 0;
                userAnswers = new Array(quiz.questions.length).fill(null);
                quizStartTime = new Date();
                quizDuration = quiz.time * 60; // Convert minutes to seconds
                timeRemaining = quizDuration;
                
                // Set quiz title
                document.getElementById('quiz-title-header').textContent = quiz.title;
                
                // Set total questions
                document.getElementById('total-questions').textContent = quiz.questions.length;
                
                // Start the timer
                startTimer();
                
                // Show the first question
                showQuestion(currentQuestion);
                
                // Switch to quiz taking view
                switchView('quiz-taking-view');
            }
            
            // Show question
            function showQuestion(index) {
                const question = currentQuiz.questions[index];
                document.getElementById('current-question').textContent = index + 1;
                document.getElementById('question-text').textContent = question.text;
                
                // Update progress bar
                const progressPercentage = ((index + 1) / currentQuiz.questions.length) * 100;
                document.getElementById('progress-bar').style.width = `${progressPercentage}%`;
                
                // Clear previous options
                const optionsContainer = document.getElementById('options-container');
                optionsContainer.innerHTML = '';
                
                // Add options
                question.options.forEach((option, optionIndex) => {
                    const optionDiv = document.createElement('div');
                    const isSelected = userAnswers[index] === optionIndex;
                    
                    optionDiv.className = `p-3 border ${isSelected ? 'border-primary-500 bg-primary-50 dark:bg-primary-900/20' : 'border-gray-200 dark:border-gray-700'} rounded-lg cursor-pointer option-item hover:bg-gray-50 dark:hover:bg-gray-700/50 transition duration-150`;
                    optionDiv.innerHTML = `
                        <div class="flex items-center">
                            <div class="flex-shrink-0 mr-2">
                                <div class="w-5 h-5 rounded-full border-2 ${isSelected ? 'border-primary-500 bg-primary-500' : 'border-gray-300 dark:border-gray-600'} flex items-center justify-center">
                                    ${isSelected ? '<svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" fill-rule="evenodd"></path></svg>' : ''}
                                </div>
                            </div>
                            <span>${option}</span>
                        </div>
                    `;
                    
                    optionDiv.addEventListener('click', function() {
                        // Set the user's answer
                        userAnswers[index] = optionIndex;
                        
                        // Update the UI to show the selected option
                        const options = optionsContainer.querySelectorAll('.option-item');
                        options.forEach((opt, idx) => {
                            if (idx === optionIndex) {
                                opt.classList.add('border-primary-500', 'bg-primary-50', 'dark:bg-primary-900/20');
                                opt.classList.remove('border-gray-200', 'dark:border-gray-700');
                                opt.querySelector('div > div').classList.add('border-primary-500', 'bg-primary-500');
                                opt.querySelector('div > div').classList.remove('border-gray-300', 'dark:border-gray-600');
                                opt.querySelector('div > div').innerHTML = '<svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" fill-rule="evenodd"></path></svg>';
                            } else {
                                opt.classList.remove('border-primary-500', 'bg-primary-50', 'dark:bg-primary-900/20');
                                opt.classList.add('border-gray-200', 'dark:border-gray-700');
                                opt.querySelector('div > div').classList.remove('border-primary-500', 'bg-primary-500');
                                opt.querySelector('div > div').classList.add('border-gray-300', 'dark:border-gray-600');
                                opt.querySelector('div > div').innerHTML = '';
                            }
                        });
                    });
                    
                    optionsContainer.appendChild(optionDiv);
                });
                
                // Enable/disable previous/next buttons
                document.getElementById('prev-question-btn').disabled = index === 0;
                
                if (index === currentQuiz.questions.length - 1) {
                    document.getElementById('next-question-btn').textContent = 'پایان آزمون';
                } else {
                    document.getElementById('next-question-btn').textContent = 'سوال بعدی';
                }
            }
            
            // Start timer
            function startTimer() {
                if (quizTimer) {
                    clearInterval(quizTimer);
                }
                
                const timerElement = document.getElementById('quiz-timer');
                timerElement.textContent = formatTime(timeRemaining);
                
                quizTimer = setInterval(function() {
                    timeRemaining--;
                    
                    if (timeRemaining <= 0) {
                        clearInterval(quizTimer);
                        endQuiz();
                    } else {
                        timerElement.textContent = formatTime(timeRemaining);
                        
                        // Change color when less than 1 minute remains
                        if (timeRemaining < 60) {
                            timerElement.classList.add('text-red-600', 'dark:text-red-400');
                        }
                    }
                }, 1000);
            }
            
            // End quiz
            function endQuiz() {
                clearInterval(quizTimer);
                quizEndTime = new Date();
                
                // Calculate score
                let score = 0;
                userAnswers.forEach((answer, index) => {
                    if (answer === currentQuiz.questions[index].correctAnswer) {
                        score++;
                    }
                });
                
                // Calculate time spent
                const timeSpent = Math.floor((quizEndTime - quizStartTime) / 1000);
                
                // Calculate percentage
                const percentage = Math.round((score / currentQuiz.questions.length) * 100);
                
                // Determine if passed
                const passed = percentage >= currentQuiz.passingScore;
                
                // Create result object
                const result = {
                    id: generateUniqueId(),
                    participantName: document.getElementById('participant-name').value,
                    score: score,
                    totalQuestions: currentQuiz.questions.length,
                    percentage: percentage,
                    timeSpent: timeSpent,
                    passed: passed,
                    date: new Date().toISOString(),
                    answers: userAnswers
                };
                
                // Save the result
                saveQuizResult(currentQuiz.id, result);
                
                // Show results
                showResults(result);
            }
            
            // Show results
            function showResults(result) {
                // Set result status
                document.getElementById('result-status').textContent = result.passed ? 'تبریک! شما در آزمون قبول شدید' : 'متأسفانه شما در آزمون رد شدید';
                
                // Show appropriate badge
                if (result.passed) {
                    document.getElementById('pass-badge').classList.remove('hidden');
                    document.getElementById('fail-badge').classList.add('hidden');
                } else {
                    document.getElementById('pass-badge').classList.add('hidden');
                    document.getElementById('fail-badge').classList.remove('hidden');
                }
                
                // Set scores
                document.getElementById('final-score').textContent = result.score;
                document.getElementById('total-score').textContent = result.totalQuestions;
                document.getElementById('score-percentage').textContent = result.percentage;
                
                // Set time spent
                const minutes = Math.floor(result.timeSpent / 60);
                const seconds = result.timeSpent % 60;
                document.getElementById('time-spent').textContent = `${minutes} دقیقه و ${seconds} ثانیه`;
                
                // Show question details
                const questionDetails = document.getElementById('question-details');
                questionDetails.innerHTML = '';
                
                currentQuiz.questions.forEach((question, index) => {
                    const userAnswer = result.answers[index];
                    const isCorrect = userAnswer === question.correctAnswer;
                    
                    const questionDiv = document.createElement('div');
                    questionDiv.className = `p-4 border ${isCorrect ? 'border-green-200 dark:border-green-800' : 'border-red-200 dark:border-red-800'} rounded-lg`;
                    
                    questionDiv.innerHTML = `
                        <div class="flex items-start">
                            <div class="flex-shrink-0 mr-3">
                                <div class="w-6 h-6 flex items-center justify-center rounded-full ${isCorrect ? 'bg-green-100 dark:bg-green-900 text-green-500 dark:text-green-300' : 'bg-red-100 dark:bg-red-900 text-red-500 dark:text-red-300'}">
                                    ${isCorrect ? 
                                        '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>' : 
                                        '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>'
                                    }
                                </div>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-bold text-gray-800 dark:text-white mb-2">سوال ${index + 1}: ${question.text}</h4>
                                <div class="space-y-2 mb-2">
                                    ${question.options.map((option, optIndex) => `
                                        <div class="flex items-center">
                                            <div class="w-4 h-4 mr-2 rounded-full ${
                                                optIndex === question.correctAnswer ? 'bg-green-500 dark:bg-green-400' : 
                                                (optIndex === userAnswer && optIndex !== question.correctAnswer) ? 'bg-red-500 dark:bg-red-400' : 
                                                'bg-gray-200 dark:bg-gray-700'
                                            }"></div>
                                            <span class="${
                                                optIndex === question.correctAnswer ? 'font-medium text-green-600 dark:text-green-400' : 
                                                (optIndex === userAnswer && optIndex !== question.correctAnswer) ? 'font-medium text-red-600 dark:text-red-400' : 
                                                'text-gray-600 dark:text-gray-400'
                                            }">${option}</span>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                    ${isCorrect ? 'پاسخ صحیح است' : `پاسخ صحیح: ${question.options[question.correctAnswer]}`}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    questionDetails.appendChild(questionDiv);
                });
                
                // Switch to results view
                switchView('results-view');
            }
            
            // Initialize quiz form
            function initQuizForm() {
                // Clear existing questions
                document.getElementById('questions-container').innerHTML = '';
                
                // Reset form
                document.getElementById('quiz-form').reset();
                
                // Add first question
                addQuestion();
            }
            
            // List user's quizzes
            function listQuizzes() {
                const quizzesList = document.getElementById('quizzes-list');
                const quizzes = JSON.parse(localStorage.getItem('quizzes') || '[]');
                
                // Show no quizzes message if there are no quizzes
                if (quizzes.length === 0) {
                    document.getElementById('no-quizzes').classList.remove('hidden');
                    return;
                }
                
                // Hide no quizzes message
                document.getElementById('no-quizzes').classList.add('hidden');
                
                // Clear the list
                quizzesList.innerHTML = '';
                
                // Add each quiz to the list
                quizzes.forEach((quiz, index) => {
                    const quizDiv = document.createElement('div');
                    quizDiv.className = 'bg-white dark:bg-gray-700 rounded-lg shadow p-4 flex flex-col md:flex-row items-center justify-between';
                    
                    const participantsCount = quiz.results ? quiz.results.length : 0;
                    
                    quizDiv.innerHTML = `
                        <div class="mb-4 md:mb-0">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white">${quiz.title}</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">کد: ${quiz.code} | تاریخ ایجاد: ${formatDate(quiz.createdAt)}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">تعداد سوالات: ${quiz.questions.length} | شرکت‌کنندگان: ${participantsCount}</p>
                        </div>
                        <div class="flex space-x-2 rtl:space-x-reverse">
                            <button class="view-quiz-btn bg-primary-600 hover:bg-primary-700 text-white font-bold py-2 px-4 rounded-lg text-sm" data-id="${quiz.id}">
                                مشاهده
                            </button>
                            <button class="share-quiz-btn bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg text-sm" data-id="${quiz.id}">
                                اشتراک
                            </button>
                            <button class="delete-quiz-btn bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg text-sm" data-id="${quiz.id}">
                                حذف
                            </button>
                        </div>
                    `;
                    
                    quizzesList.appendChild(quizDiv);
                });
                
                // Add event listeners to buttons
                quizzesList.querySelectorAll('.view-quiz-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const quizId = this.dataset.id;
                        showQuizDetails(quizId);
                    });
                });
                
                quizzesList.querySelectorAll('.share-quiz-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const quizId = this.dataset.id;
                        showShareView(quizId);
                    });
                });
                
                quizzesList.querySelectorAll('.delete-quiz-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const quizId = this.dataset.id;
                        deleteQuiz(quizId);
                    });
                });
            }
            
            // Show quiz details
            function showQuizDetails(quizId) {
                const quiz = getQuizById(quizId);
                if (!quiz) return;
                
                // Set quiz details
                document.getElementById('quiz-details-title').textContent = quiz.title;
                document.getElementById('quiz-details-description').textContent = quiz.description;
                document.getElementById('quiz-details-date').textContent = formatDate(quiz.createdAt);
                document.getElementById('quiz-details-questions-count').textContent = quiz.questions.length;
                document.getElementById('quiz-details-time').textContent = quiz.time;
                document.getElementById('quiz-details-passing').textContent = quiz.passingScore;
                document.getElementById('quiz-details-code').textContent = quiz.code;
                
                // Set share link
                const shareLink = `${window.location.origin}${window.location.pathname}?quiz=${quiz.code}`;
                document.getElementById('quiz-details-link').value = shareLink;
                
                // Set participants count
                const participantsCount = quiz.results ? quiz.results.length : 0;
                document.getElementById('quiz-details-participants').textContent = participantsCount;
                
                // Show results table if there are participants
                if (participantsCount > 0) {
                    document.getElementById('no-participants').classList.add('hidden');
                    document.getElementById('results-table').classList.remove('hidden');
                    
                    // Clear the table body
                    const tableBody = document.getElementById('results-table-body');
                    tableBody.innerHTML = '';
                    
                    // Add each participant to the table
                    quiz.results.forEach((result, index) => {
                        const row = document.createElement('tr');
                        row.className = index % 2 === 0 ? 'bg-white dark:bg-gray-800' : 'bg-gray-50 dark:bg-gray-700';
                        
                        row.innerHTML = `
                            <td class="px-4 py-2 border-b border-gray-200 dark:border-gray-700">${index + 1}</td>
                            <td class="px-4 py-2 border-b border-gray-200 dark:border-gray-700">${result.participantName}</td>
                            <td class="px-4 py-2 border-b border-gray-200 dark:border-gray-700">${result.percentage}%</td>
                            <td class="px-4 py-2 border-b border-gray-200 dark:border-gray-700">${result.score} از ${result.totalQuestions}</td>
                            <td class="px-4 py-2 border-b border-gray-200 dark:border-gray-700">
                                <span class="px-2 py-1 rounded text-xs font-medium ${result.passed ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' : 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200'}">
                                    ${result.passed ? 'قبول' : 'رد'}
                                </span>
                            </td>
                            <td class="px-4 py-2 border-b border-gray-200 dark:border-gray-700">${formatDate(result.date)}</td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                } else {
                    document.getElementById('no-participants').classList.remove('hidden');
                    document.getElementById('results-table').classList.add('hidden');
                }
                
                // Switch to quiz details view
                switchView('quiz-details-view');
            }
            
            // Show share view
            function showShareView(quizId) {
                const quiz = getQuizById(quizId);
                if (!quiz) return;
                
                // Set quiz title
                document.getElementById('share-quiz-title').textContent = quiz.title;
                
                // Set quiz code
                document.getElementById('share-quiz-code').textContent = quiz.code;
                
                // Set share link
                const shareLink = `${window.location.origin}${window.location.pathname}?quiz=${quiz.code}`;
                document.getElementById('share-quiz-link').value = shareLink;
                
                // Set view quiz details button
                document.getElementById('view-quiz-details-btn').dataset.id = quiz.id;
                
                // Switch to share view
                switchView('share-view');
            }
            
            // Delete quiz
            function deleteQuiz(quizId) {
                if (!confirm('آیا از حذف این آزمون اطمینان دارید؟')) return;
                
                let quizzes = JSON.parse(localStorage.getItem('quizzes') || '[]');
                quizzes = quizzes.filter(quiz => quiz.id !== quizId);
                localStorage.setItem('quizzes', JSON.stringify(quizzes));
                
                // Refresh the list
                listQuizzes();
                
                // Show success message
                showAlert('آزمون با موفقیت حذف شد', 'success');
            }
            
            // Check for quiz code in URL
            function checkUrlForQuizCode() {
                const urlParams = new URLSearchParams(window.location.search);
                const quizCode = urlParams.get('quiz');
                
                if (quizCode) {
                    // Switch to take quiz view
                    switchView('take-quiz-view');
                    
                    // Set the quiz code
                    document.getElementById('quiz-code').value = quizCode;
                    
                    // Find the quiz
                    const quiz = getQuizByCode(quizCode);
                    if (quiz) {
                        // Show quiz details
                        showQuizInfo(quiz);
                    } else {
                        showAlert('آزمون مورد نظر یافت نشد', 'error');
                    }
                }
            }
            
            // Show quiz info
            function showQuizInfo(quiz) {
                document.getElementById('quiz-info-title').textContent = quiz.title;
                document.getElementById('quiz-info-description').textContent = quiz.description;
                document.getElementById('quiz-info-questions').querySelector('span').textContent = quiz.questions.length;
                document.getElementById('quiz-info-time').querySelector('span').textContent = quiz.time;
                document.getElementById('quiz-info-passing').querySelector('span').textContent = quiz.passingScore;
                
                document.getElementById('quiz-details').classList.remove('hidden');
                document.getElementById('start-quiz-btn').disabled = !document.getElementById('participant-name').value;
            }
            
            // Initialize the application
            function init() {
                // Check for quiz code in URL
                checkUrlForQuizCode();
                
                // Add first question to the quiz form
                initQuizForm();
                
                // Event listeners for navigation
                document.getElementById('create-quiz-btn').addEventListener('click', function() {
                    switchView('create-quiz-view');
                    initQuizForm();
                });
                
                document.getElementById('take-quiz-btn').addEventListener('click', function() {
                    switchView('take-quiz-view');
                });
                
                document.getElementById('my-quizzes-btn').addEventListener('click', function() {
                    switchView('my-quizzes-view');
                    listQuizzes();
                });
                
                document.getElementById('back-to-home-btn').addEventListener('click', function() {
                    switchView('home-view');
                });
                
                document.getElementById('back-from-take-quiz').addEventListener('click', function() {
                    switchView('home-view');
                });
                
                document.getElementById('back-from-my-quizzes').addEventListener('click', function() {
                    switchView('home-view');
                });
                
                document.getElementById('back-from-quiz-details').addEventListener('click', function() {
                    switchView('my-quizzes-view');
                    listQuizzes();
                });
                
                document.getElementById('back-from-share').addEventListener('click', function() {
                    switchView('my-quizzes-view');
                    listQuizzes();
                });
                
                document.getElementById('back-to-home-from-results').addEventListener('click', function() {
                    switchView('home-view');
                });
                
                document.getElementById('create-first-quiz-btn').addEventListener('click', function() {
                    switchView('create-quiz-view');
                    initQuizForm();
                });
                
                // Add question button
                document.getElementById('add-question-btn').addEventListener('click', function() {
                    addQuestion();
                });
                
                // Quiz form submission
                document.getElementById('quiz-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const title = document.getElementById('quiz-title').value;
                    const description = document.getElementById('quiz-description').value;
                    const time = parseInt(document.getElementById('quiz-time').value);
                    const passingScore = parseInt(document.getElementById('quiz-passing-score').value);
                    
                    // Get questions
                    const questions = [];
                    document.querySelectorAll('.question-item').forEach(questionEl => {
                        const questionText = questionEl.querySelector('.question-text').value;
                        const options = Array.from(questionEl.querySelectorAll('.option-text')).map(opt => opt.value);
                        const correctAnswer = parseInt(questionEl.querySelector('input[type="radio"]:checked').value);
                        
                        questions.push({
                            text: questionText,
                            options: options,
                            correctAnswer: correctAnswer
                        });
                    });
                    
                    // Validate
                    if (questions.length === 0) {
                        showAlert('حداقل یک سوال اضافه کنید', 'error');
                        return;
                    }
                    
                    // Create quiz object
                    const quizId = generateUniqueId();
                    const quizCode = Math.random().toString(36).substring(2, 8).toUpperCase();
                    
                    const quiz = {
                        id: quizId,
                        code: quizCode,
                        title: title,
                        description: description,
                        time: time,
                        passingScore: passingScore,
                        questions: questions,
                        createdAt: new Date().toISOString(),
                        results: []
                    };
                    
                    // Save the quiz
                    saveQuiz(quiz);
                    
                    // Show success message
                    showAlert('آزمون با موفقیت ساخته شد', 'success');
                    
                    // Show share view
                    showShareView(quizId);
                });
                
                // Find quiz button
                document.getElementById('find-quiz-btn').addEventListener('click', function() {
                    const quizCode = document.getElementById('quiz-code').value;
                    if (!quizCode) {
                        showAlert('کد آزمون را وارد کنید', 'error');
                        return;
                    }
                    
                    const quiz = getQuizByCode(quizCode);
                    if (quiz) {
                        showQuizInfo(quiz);
                    } else {
                        showAlert('آزمون مورد نظر یافت نشد', 'error');
                    }
                });
                
                // Participant name input
                document.getElementById('participant-name').addEventListener('input', function() {
                    document.getElementById('start-quiz-btn').disabled = !this.value;
                });
                
                // Start quiz button
                document.getElementById('start-quiz-btn').addEventListener('click', function() {
                    const quizCode = document.getElementById('quiz-code').value;
                    const participantName = document.getElementById('participant-name').value;
                    
                    if (!quizCode) {
                        showAlert('کد آزمون را وارد کنید', 'error');
                        return;
                    }
                    
                    if (!participantName) {
                        showAlert('نام خود را وارد کنید', 'error');
                        return;
                    }
                    
                    const quiz = getQuizByCode(quizCode);
                    if (quiz) {
                        startQuiz(quiz, participantName);
                    } else {
                        showAlert('آزمون مورد نظر یافت نشد', 'error');
                    }
                });
                
                // Previous question button
                document.getElementById('prev-question-btn').addEventListener('click', function() {
                    if (currentQuestion > 0) {
                        currentQuestion--;
                        showQuestion(currentQuestion);
                    }
                });
                
                // Next question button
                document.getElementById('next-question-btn').addEventListener('click', function() {
                    if (currentQuestion < currentQuiz.questions.length - 1) {
                        currentQuestion++;
                        showQuestion(currentQuestion);
                    } else {
                        endQuiz();
                    }
                });
                
                // View quiz details button
                document.getElementById('view-quiz-details-btn').addEventListener('click', function() {
                    const quizId = this.dataset.id;
                    showQuizDetails(quizId);
                });
                
                // Copy link buttons
                document.getElementById('copy-link-btn').addEventListener('click', function() {
                    const linkInput = document.getElementById('quiz-details-link');
                    linkInput.select();
                    document.execCommand('copy');
                    showAlert('لینک کپی شد', 'success');
                });
                
                document.getElementById('copy-share-link-btn').addEventListener('click', function() {
                    const linkInput = document.getElementById('share-quiz-link');
                    linkInput.select();
                    document.execCommand('copy');
                    showAlert('لینک کپی شد', 'success');
                });
                
                document.getElementById('copy-code-btn').addEventListener('click', function() {
                    const code = document.getElementById('share-quiz-code').textContent;
                    navigator.clipboard.writeText(code).then(function() {
                        showAlert('کد کپی شد', 'success');
                    });
                });
                
                // Share results button
                document.getElementById('share-results-btn').addEventListener('click', function() {
                    showAlert('نتیجه آزمون کپی شد', 'success');
                });
            }
            
            // Initialize the app
            init();
        });
    </script>
</body>
</html>
